app-id: io.github.MarkusAureus.MediaCatcher
runtime: org.freedesktop.Platform
runtime-version: '23.08'
sdk: org.freedesktop.Sdk
command: media-catcher
finish-args:
  - --share=network
  - --share=ipc
  - --socket=x11
  - --socket=wayland
  - --device=dri
  - --filesystem=xdg-download
  - --filesystem=home
  - --talk-name=org.freedesktop.Notifications
  - --env=QT_QPA_PLATFORM=xcb

modules:
  - name: python3-PyQt5
    buildsystem: simple
    build-commands:
      - pip3 install --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} PyQt5 PyQt5-sip
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/4d/81/b9a66a28fb6e18c5117de02a6dc525de2a23b074d336ec957b8a83c7ec2a/PyQt5-5.15.10.tar.gz
        sha256: d46b7804b1b10a4ff91753f8113e5b192a2b174454086e15cbe1e20c6f3bb38a
      - type: file
        url: https://files.pythonhosted.org/packages/73/8c/c662b7ebc4b2407d8679da68e11c2a2eb275f5f2242a92610f6e5024c1f2/PyQt5_sip-12.13.0.tar.gz
        sha256: 7f321daf84b9c9dbca61b80e1ef37bdaffc0e93312edae2cd7da25b953971d91

  - name: yt-dlp
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} yt-dlp
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/source/y/yt-dlp/yt_dlp-2024.5.27-py3-none-any.whl
        sha256: 3b44e629d89b1c8c69c80592773d83249bd00119b0468aa0506a9e7acdbfac98

  - name: ffmpeg
    config-opts:
      - --enable-shared
      - --disable-static
      - --enable-gnutls
      - --disable-doc
      - --disable-programs
      - --enable-encoder=png,libwebp
      - --enable-libwebp
    sources:
      - type: archive
        url: https://ffmpeg.org/releases/ffmpeg-6.1.1.tar.xz
        sha256: 8684f4b00f94b85461884c3719382f1261f0d9eb3d59640a1f4ac0873616f968
    modules:
      - name: libwebp
        config-opts:
          - --disable-static
          - --enable-libwebpmux
          - --enable-libwebpdemux
        sources:
          - type: archive
            url: https://storage.googleapis.com/downloads.webmproject.org/releases/webp/libwebp-1.3.2.tar.gz
            sha256: 2a499607df669e40258e53d0ade8035ba4ec0175244869d1025d460562aa09b4

  - name: media-catcher
    buildsystem: simple
    build-commands:
      - install -Dm755 media-catcher.py ${FLATPAK_DEST}/bin/media-catcher
      - install -Dm644 themes.json ${FLATPAK_DEST}/share/media-catcher/themes.json
      - install -Dm644 io.github.MarkusAureus.MediaCatcher.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/io.github.MarkusAureus.MediaCatcher.svg
      - install -Dm644 io.github.MarkusAureus.MediaCatcher.desktop ${FLATPAK_DEST}/share/applications/io.github.MarkusAureus.MediaCatcher.desktop
      - install -Dm644 io.github.MarkusAureus.MediaCatcher.metainfo.xml ${FLATPAK_DEST}/share/metainfo/io.github.MarkusAureus.MediaCatcher.metainfo.xml
    sources:
      - type: git
        url: https://github.com/MarkusAureus/MediaCatcher.git
        tag: v1.0.0
        commit: YOUR_COMMIT_SHA_HERE
      - type: file
        path: io.github.MarkusAureus.MediaCatcher.desktop
      - type: file
        path: io.github.MarkusAureus.MediaCatcher.metainfo.xml
